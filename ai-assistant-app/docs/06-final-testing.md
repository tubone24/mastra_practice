# 06. 最終テストと確認

## 概要
このドキュメントでは、開発したAIアシスタントアプリケーションの最終テストと動作確認の手順を説明します。

## ローカル環境でのテスト

### 1. 環境変数の確認

.env.local ファイルに以下が設定されていることを確認：

```
OPENAI_API_KEY=sk-your-actual-api-key
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

### 3. 基本機能のテスト

http://localhost:3000 にアクセスして以下を確認：

1. **チャット機能**
   - メッセージを送信できる
   - AIからの応答が表示される
   - ストリーミング形式で応答が表示される

2. **Mastraエージェント**
   - カスタムインストラクションが反映されている
   - 日本語での応答が適切に表示される

3. **ツール機能**
   - Web検索に関する質問をする（例：「最新のAI技術について教えて」）
   - ツールが呼び出されることを確認

### 4. ビルドテスト

```bash
npm run build
```

ビルドが成功することを確認。

### 5. プロダクションビルドの実行

```bash
npm start
```

http://localhost:3000 でプロダクションビルドが正常に動作することを確認。

## エラーチェック

### コンソールエラーの確認
ブラウザの開発者ツールを開いて、コンソールにエラーがないことを確認。

### ネットワークエラーの確認
Network タブで API 呼び出しが成功していることを確認。

## パフォーマンステスト

### 初期読み込み時間
- ページの読み込みが3秒以内に完了する
- First Contentful Paint (FCP) が1.5秒以内

### レスポンス時間
- AIの応答開始まで2秒以内
- ストリーミング応答がスムーズに表示される

## セキュリティチェック

### APIキーの保護
- クライアントサイドのコードにAPIキーが含まれていないことを確認
- ブラウザの開発者ツールでAPIキーが露出していないことを確認

### エラーハンドリング
- 無効な入力に対して適切なエラーメッセージが表示される
- APIエラー時に適切なフォールバック処理が行われる

## アクセシビリティチェック

### キーボードナビゲーション
- Tabキーですべての操作可能な要素にアクセスできる
- Enterキーでメッセージを送信できる

### スクリーンリーダー対応
- 適切なARIA属性が設定されている
- フォーカス管理が適切に行われている

## トラブルシューティング

### よくある問題と解決方法

1. **「OpenAI API key not found」エラー**
   - .env.local ファイルが正しく作成されているか確認
   - 環境変数名が正しいか確認（OPENAI_API_KEY）
   - 開発サーバーを再起動

2. **ビルドエラー**
   - Node.js バージョンを確認（推奨: v20以上）
   - node_modules を削除して再インストール
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **Mastraエージェントエラー**
   - エージェント名が正しく設定されているか確認
   - next.config.ts の serverExternalPackages を確認

## 完了チェックリスト

- [ ] ローカル開発環境で正常に動作する
- [ ] ビルドが成功する
- [ ] プロダクションビルドが正常に動作する
- [ ] エラーハンドリングが適切に実装されている
- [ ] APIキーが安全に管理されている
- [ ] 基本的なアクセシビリティ要件を満たしている

## 次のステップ

1. GitHubリポジトリにプッシュ
2. AWS Amplifyでデプロイ
3. 本番環境でのテスト
4. カスタムドメインの設定（オプション）
5. モニタリングとログの設定

## まとめ

このハンズオンチュートリアルでは、以下の技術スタックを使用してAIアシスタントアプリケーションを構築しました：

- **Next.js 15**: モダンなReactフレームワーク
- **Assistant UI**: 高品質なチャットUI
- **Mastra**: TypeScript AIエージェントフレームワーク
- **Vercel AI SDK**: 統一されたAIインターフェース
- **MCP**: 標準化されたツール接続
- **AWS Amplify Gen2**: フルスタックデプロイメント

これらの技術を組み合わせることで、プロダクションレディなAIアプリケーションを効率的に構築できました。